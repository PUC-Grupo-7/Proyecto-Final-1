<!-- movie_bot/templates/chat.html -->
{% extends "base.html" %}

{% block content %}
<div class="container mt-5">
    <h1 class="text-center">Chat con MovieBot</h1>

    <!-- Formulario para enviar mensajes -->
    <form method="POST" action="{{ url_for('chat') }}">
        <!-- Mensajes pre-hechos -->
        <div class="mb-3 d-flex justify-content-between flex-wrap">
            <button type="submit" name="message" value="RecomiÃ©ndame una pelÃ­cula de acciÃ³n" class="btn btn-primary mb-2" formnovalidate aria-label="RecomiÃ©ndame una pelÃ­cula de acciÃ³n">
                ğŸ¬ AcciÃ³n
            </button>
            <button type="submit" name="message" value="Quiero ver algo de comedia" class="btn btn-success mb-2" formnovalidate aria-label="Quiero ver algo de comedia">
                ğŸ˜‚ Comedia
            </button>
            <button type="submit" name="message" value="Dame una recomendaciÃ³n de drama" class="btn btn-warning mb-2" formnovalidate aria-label="Dame una recomendaciÃ³n de drama">
                ğŸ­ Drama
            </button>
            <button type="submit" name="message" value="Sugerencia de una pelÃ­cula romÃ¡ntica" class="btn btn-danger mb-2" formnovalidate aria-label="Sugerencia de una pelÃ­cula romÃ¡ntica">
                â¤ï¸ Romance
            </button>
            <button type="submit" name="message" value="RecomiÃ©ndame algo de terror" class="btn btn-dark mb-2" formnovalidate aria-label="RecomiÃ©ndame algo de terror">
                ğŸ‘» Terror
            </button>
            <button type="submit" name="message" value="Â¿QuÃ© pelÃ­cula de suspenso me recomiendas?" class="btn btn-secondary mb-2" formnovalidate aria-label="Â¿QuÃ© pelÃ­cula de suspenso me recomiendas?">
                ğŸ•µï¸ Suspenso
            </button>
        </div>

        <!-- Campo de texto para mensajes personalizados -->
        <div class="mb-3">
            <input type="text" name="message" class="form-control" placeholder="Escribe tu mensaje..." required aria-label="Mensaje personalizado">
        </div>
        <button type="submit" class="btn btn-primary">Enviar</button>
    </form>

    <!-- Historial del chat -->
    <div id="chat-messages" class="border p-3 mt-4" style="height: 400px; overflow-y: auto;">
        {% for msg in messages %}
        <div class="mb-3 d-flex {% if msg.author == 'user' %}justify-content-end{% else %}justify-content-start{% endif %}">
            {% if msg.author != 'user' %}
            <!-- Imagen del bot -->
            <img src="{{ url_for('static', filename='images/bot_avatar.png') }}" alt="Bot Avatar" class="rounded-circle me-2" style="width: 40px; height: 40px;">
            {% endif %}
            <div class="p-3 {% if msg.author == 'user' %}bg-primary text-white rounded-end{% else %}bg-light rounded-start{% endif %} shadow-sm" style="max-width: 75%; word-wrap: break-word;">
                <strong>{{ "TÃº" if msg.author == "user" else "MovieBot" }}</strong><br>
                {{ msg.content }}
            </div>
        </div>
        {% endfor %}
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    document.addEventListener("DOMContentLoaded", () => {
        const chatMessages = document.getElementById("chat-messages");

        // Desplazar automÃ¡ticamente al final del chat
        function scrollToBottom() {
            if (chatMessages) {
                chatMessages.scrollTop = chatMessages.scrollHeight;
            }
        }

        // Desplazar automÃ¡ticamente al cargar la pÃ¡gina
        scrollToBottom();

        // Desplazar al final despuÃ©s de enviar un mensaje
        const form = document.querySelector("form");
        if (form) {
            form.addEventListener("submit", (event) => {
                setTimeout(scrollToBottom, 100); // Retardo para procesar el DOM despuÃ©s del envÃ­o
            });
        }
    });
</script>
{% endblock %}
